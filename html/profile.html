<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>í”„ë¡œí•„</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter ë¡œë“œ -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ê¸°ë³¸ ë ˆì´ì•„ì›ƒê³¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
      body {
        font-family: "Inter", sans-serif; /* Google Fonts Inter ì ìš© */
        margin: 0;
        padding: 0;
        background-color: #f4f7f6;
        color: #333;
      }
      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        background-color: #ffffff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .toolbar-left .logo {
        font-size: 24px;
        font-weight: bold;
        color: #3b82f6;
        text-decoration: none;
      }
      .toolbar-right {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        gap: 20px;
      }
      .toolbar-right li a {
        text-decoration: none;
        color: #555;
        font-weight: 600;
        transition: color 0.2s ease-in-out;
      }
      .toolbar-right li a:hover {
        color: #3b82f6;
      }

      /* ì‚¬ìš©ì ì œê³µ CSS (memberInfo ê´€ë ¨) */
      .memberInfo {
        display: flex;
        flex-direction: row; /* ìˆ˜í‰ ì •ë ¬ */
        justify-content: center; /* ê°€ìš´ë° ì •ë ¬ */
        gap: 10px; /* ë²„íŠ¼ ê°„ ê°„ê²© */
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .memberInfo li a {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 80px;
        height: 80px;
        text-decoration: none;
        color: black;
        font-size: 0.875rem; /* text-smì— í•´ë‹¹ */
        font-weight: 500; /* medium */
      }
      .memberInfo li a img {
        display: block;
        width: 36px; /* ì´ë¯¸ì§€ í¬ê¸° */
        height: 36px;
        margin-bottom: 4px; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
      }

      .profile-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .profile-header {
        display: flex;
        align-items: flex-start; /* Align items to the start for proper vertical spacing */
        gap: 30px;
        padding-bottom: 30px;
        border-bottom: 1px solid #eee;
      }

      /* --- MODIFIED CSS for image section and button --- */
      .image-section {
        display: flex; /* Use flexbox */
        flex-direction: column; /* Stack children vertically */
        align-items: center; /* Center horizontally */
        flex-shrink: 0;
      }

      .profile-image-wrapper {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
        border: 3px solid #3b82f6;
        margin-bottom: 10px; /* Space between image and button */
      }

      .profile-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .small-button {
        background-color: #3b82f6; /* Changed to primary button color */
        color: white;
        padding: 8px 15px; /* Adjusted padding */
        border-radius: 5px;
        font-size: 14px; /* Adjusted font size */
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
        text-align: center; /* Ensure text is centered within the button */
        display: inline-block; /* Make it an inline-block to respect padding/margin */
      }
      /* --- END MODIFIED CSS --- */

      .small-button:hover {
        background-color: #2a6bbd; /* Darker primary color on hover */
      }
      .profile-info {
        flex-grow: 1;
      }
      .profile-info h2 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #333;
      }
      .profile-info p {
        font-size: 16px;
        color: #666;
        margin-bottom: 20px;
        line-height: 1.5;
      }
      .profile-info button {
        background-color: #3b82f6;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s ease-in-out;
      }
      .profile-info button:hover {
        background-color: #2a6bbd;
      }

      /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
      .modal {
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        position: fixed; /* í™”ë©´ì— ê³ ì • */
        z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
        left: 0;
        top: 0;
        width: 100%; /* ì „ì²´ ë„ˆë¹„ */
        height: 100%; /* ì „ì²´ ë†’ì´ */
        overflow: auto; /* ë‚´ìš©ì´ ë„˜ì¹  ê²½ìš° ìŠ¤í¬ë¡¤ í—ˆìš© */
        background-color: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        text-align: center;
      }

      .modal-content h3 {
        margin-top: 0;
        color: #333;
      }

      .modal-content input[type="text"],
      .modal-content textarea {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }

      .modal-content textarea {
        resize: vertical;
        min-height: 80px;
      }

      /* General modal button style (will be overridden by specific ones below) */
      .modal-content button {
        background-color: #3b82f6;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        transition: background-color 0.2s ease-in-out;
      }

      .modal-content button:hover {
        background-color: #2a6bbd;
      }

      /* Styles for comment action buttons to remove blue background */
      .comment-actions button {
        background: none !important; /* Remove any background */
        box-shadow: none !important; /* Remove any box shadow */
        color: #6b7280; /* text-gray-500 from Tailwind */
        border: none;
        padding: 0;
        margin: 0;
      }

      /* Ensure hover effects are still applied for color change only */
      .comment-actions button:hover {
        color: #3b82f6; /* Blue-500 hover for reply */
      }
      .comment-actions .like-button:hover {
        color: #ef4444; /* Red-500 hover for like */
      }

      /* Stylish Close Button in Post View Modal (X button) */
      #closeCommentModalButton {
        background-color: #60a5fa; /* Tailwind blue-400 for a softer blue */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px; /* Slightly more rounded */
        cursor: pointer;
        font-size: 1rem; /* Base font size */
        transition: background-color 0.2s ease-in-out,
          transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add a subtle shadow */
        position: absolute;
        top: 15px; /* Adjust as needed */
        right: 15px; /* Adjust as needed */
        background: transparent; /* Make it transparent */
        color: #6b7280; /* Gray text color */
        font-size: 2rem; /* Larger 'X' */
        padding: 0;
        line-height: 1; /* Remove extra line height */
        width: auto;
        height: auto;
        box-shadow: none; /* No shadow */
      }
      #closeCommentModalButton:hover {
        background-color: transparent; /* Keep transparent */
        color: #374151; /* Darker gray on hover */
        transform: translateY(0); /* No lift effect for 'X' button */
        box-shadow: none; /* No shadow */
      }
      #closeImageModal,
      #closeEditModal,
      #confirmNoBtn,
      #closeAlertModal {
        background-color: #9ca3af; /* Tailwind gray-400 for a neutral gray */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px; /* Consistent rounded corners */
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.2s ease-in-out,
          transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
      }
      #closeImageModal:hover,
      #closeEditModal:hover,
      #confirmNoBtn:hover,
      #closeAlertModal:hover {
        background-color: #6b7280; /* Tailwind gray-500 on hover */
        transform: translateY(-1px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.12);
      }

      /* ì „ì²´ ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
      #clearAllBtn {
        padding: 10px 20px;
        background-color: #dc3545; /* Red color for delete */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }
      #clearAllBtn:hover {
        background-color: #c82333; /* Darker red on hover */
      }

      /* My Posts Section Styles */
      .my-posts-section {
        max-width: 800px;
        margin: 40px auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .post-card {
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        cursor: pointer;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        position: relative; /* For delete button positioning */
        height: 250px; /* Increased height to accommodate image and text */
        overflow: hidden; /* Ensure rounded corners and image fit */
      }

      .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .post-card-image {
        width: 100%;
        height: 120px; /* Fixed height for small image preview in card */
        object-fit: cover;
        border-radius: 8px 8px 0 0; /* Rounded top corners to match card */
        display: block; /* Ensure it behaves as a block element */
        background-color: #e0e0e0; /* Placeholder background */
      }

      .post-card-content-wrapper {
        padding: 15px; /* Add padding to text content wrapper */
        flex-grow: 1; /* Allow content wrapper to take remaining space */
        display: flex;
        flex-direction: column;
      }

      .post-card-title {
        font-weight: 600;
        font-size: 1.125rem; /* text-lg */
        color: #333;
        margin-bottom: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .post-card-text {
        font-size: 0.9375rem; /* ~15px */
        color: #666;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* Show max 2 lines to make space for title/image */
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-grow: 1; /* Allows text content to take available space */
      }

      .post-card-delete-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 0.75rem; /* text-xs */
        padding: 4px 8px;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
        opacity: 0.8;
      }

      .post-card-delete-btn:hover {
        background-color: #c82333;
        opacity: 1;
      }

      #commentModal .modal-content {
        max-width: 1000px;
        width: 90%;
        display: flex;
        min-height: 600px;
        text-align: left;
        position: relative;
      }
      #commentModal .modal-post-display {
        flex: 2;
        border-right: 1px solid #e0e0e0;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }
      .modal-post-image {
        width: 100%;
        height: auto;
        max-height: 400px;
        object-fit: contain;
        display: block;
        background-color: #e0e0e0;
      }
      #commentModal .modal-comment-area {
        flex: 1;
        padding-left: 24px;
        display: flex;
        flex-direction: column;
      }
      #commentModal .comment-list {
        flex-grow: 1;
        overflow-y: auto;
        margin-bottom: 16px;
      }
      #commentModal .modal-post-content-wrapper {
        padding: 24px;
      }
      #modalCommentInput {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px 15px;
        box-sizing: border-box;
        font-size: 0.95rem;
      }
      #modalCommentSubmitButton {
        background-color: #3b82f6;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        transition: background-color 0.2s;
        margin-left: 10px;
      }
      #modalCommentSubmitButton:hover {
        background-color: #2a6bbd;
      }

      .comment-item,
      .reply-item {
        background-color: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      .reply-item {
        margin-left: 20px;
        background-color: #fdfdfd;
      }
      .comment-content-wrapper {
        display: flex;
        flex-direction: column;
        margin-bottom: 4px;
      }
      .comment-text-line {
        display: flex;
        align-items: baseline;
      }
      .comment-text-line .comment-username {
        font-weight: 600;
        color: #1f2937;
        margin-right: 8px;
        font-size: 0.875rem;
      }
      .comment-text-line .comment-body {
        color: #374151;
        font-size: 0.875rem;
        flex: 1;
      }
      .comment-time {
        font-size: 0.75rem;
        color: #9ca3af;
        margin-top: 4px;
      }

      .comment-actions {
        display: flex;
        align-items: center;
        font-size: 0.75rem;
        color: #6b7280;
        gap: 12px;
        margin-left: 0;
      }
      .comment-actions button {
        display: flex;
        align-items: center;
        padding: 0;
        border-radius: 4px;
        transition: color 0.2s;
      }
      .comment-actions .like-button .comment-like-count {
        margin-right: 4px;
      }

      .reply-input-area {
        background-color: #fff;
        padding: 8px;
        border-radius: 8px;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
        margin-left: 15px;
      }
      .reply-input-area input {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 6px 10px;
      }
      .reply-input-area button {
        white-space: nowrap;
        padding: 6px 12px;
        font-size: 0.875rem;
        background-color: #e5e7eb;
        color: #374151;
        border: none;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease-in-out;
      }
      .reply-input-area button:hover {
        background-color: #d1d5db;
      }

      .view-replies-toggle {
        color: #374151 !important;
        font-size: 0.75rem;
        font-weight: 500;
        margin-top: 4px;
        display: block;
        text-align: left;
        padding: 4px 0;
        cursor: pointer;
        margin-left: 0px;
        background: transparent !important;
        box-shadow: none !important;
      }
      .view-replies-toggle:hover {
        text-decoration: underline;
        color: #3b82f6 !important;
      }
      .replies-list {
        margin-left: 0px;
        padding-left: 0px;
      }
    </style>
  </head>
  <body>
    <!-- íˆ´ë°” -->
    <nav class="toolbar">
      <div class="toolbar-left">
        <a href="/Summer_Project/html/index.html" class="logo">ì˜¤ëŠ˜ì˜ í•œ ì¤„</a>
      </div>
      <ul class="toolbar-right memberInfo">
        <li id="profileLoginButton">
          <a href="/Summer_Project/html/login.html">
            <img
              src="https://img.cgv.co.kr/R2014/images/common/ico/loginPassword.png"
              alt="ë¡œê·¸ì¸"
              onerror="this.src='https://placehold.co/36x36/ccc/000?text=ë¡œê·¸ì¸';"
            />
            <span>ë¡œê·¸ì¸</span>
          </a>
        </li>
        <li id="profileSignupButton">
          <a href="/Summer_Project/html/signup.html">
            <img
              src="https://img.cgv.co.kr/R2014/images/common/ico/loginJoin.png"
              alt="íšŒì›ê°€ì…"
              onerror="this.src='https://placehold.co/36x36/ccc/000?text=íšŒì›ê°€ì…';"
            />
            <span>íšŒì›ê°€ì…</span>
          </a>
        </li>
        <li id="profileLogoutButton" style="display: none">
          <a href="/Summer_Project/html/login.html">
            <img
              src="https://img.cgv.co.kr/R2014/images/common/ico/loginPassword.png"
              alt="ë¡œê·¸ì•„ì›ƒ"
              onerror="this.src='https://placehold.co/36x36/ccc/000?text=ë¡œê·¸ì•„ì›ƒ';"
            />
            <span>ë¡œê·¸ì•„ì›ƒ</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- í”„ë¡œí•„ ë©”ì¸ -->
    <div class="profile-container">
      <div class="profile-header">
        <div class="image-section">
          <div class="profile-image-wrapper">
            <img id="profileImage" class="profile-image" alt="í”„ë¡œí•„ ì‚¬ì§„" />
          </div>
          <label class="small-button" for="imageInput">ì‚¬ì§„ ë³€ê²½</label>
          <input
            type="file"
            id="imageInput"
            accept="image/*"
            style="display: none"
          />
        </div>
        <div class="profile-info">
          <h2 id="displayName"></h2>
          <p id="bio"></p>
          <p id="phoneNumber" class="text-gray-600 text-sm mt-2"></p>
          <button id="editProfileBtn">í”„ë¡œí•„ í¸ì§‘</button>
        </div>
      </div>
    </div>

    <!-- ë‚´ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ ì„¹ì…˜ -->
    <div class="my-posts-section">
      <h3 class="text-2xl font-semibold mb-4 text-gray-800">
        ë‚´ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€
      </h3>
      <div
        id="userPostsGrid"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-8"
      >
        <!-- User's posts will be dynamically loaded here -->
      </div>
    </div>

    <!-- í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ -->
    <div class="modal" id="editModal">
      <div class="modal-content">
        <h3>í”„ë¡œí•„ í¸ì§‘</h3>
        <input type="text" id="nameInput" placeholder="ì´ë¦„" />
        <input type="text" id="phoneInput" placeholder="ì „í™”ë²ˆí˜¸" />
        <textarea id="bioInput" placeholder="ì†Œê°œê¸€"></textarea>
        <button id="saveBtn">ì €ì¥</button>
        <button id="closeEditModal">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
    <div class="modal" id="imageModal">
      <div class="modal-content">
        <img src="" alt="í™•ëŒ€ ì´ë¯¸ì§€" id="modalImage" style="width: 100%" />
        <button id="closeImageModal">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="commentModal" class="modal">
      <div class="modal-content">
        <!-- ê²Œì‹œê¸€ ë‚´ìš© í‘œì‹œ ì˜ì—­ -->
        <div class="modal-post-display">
          <div class="modal-post-content-wrapper p-6">
            <h2
              id="modalPostTitle"
              class="text-2xl font-bold text-gray-800 mb-4"
            >
              ê²Œì‹œê¸€ ì œëª©
            </h2>
            <img
              id="modalPostImage"
              src=""
              alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€"
              class="modal-post-image mb-4 hidden"
            />
            <p
              id="modalPostText"
              class="text-gray-800 leading-relaxed mb-2"
            ></p>
            <div
              id="modalPostTags"
              class="mt-2 flex flex-wrap gap-2 mb-4"
            ></div>
            <div class="flex items-center text-sm text-gray-500 mt-4">
              <span
                id="modalPostAuthor"
                class="font-semibold text-gray-700 mr-2"
              ></span>
              <span id="modalPostTime"></span>
            </div>
          </div>
        </div>

        <!-- ëŒ“ê¸€ ì‘ì„± ë° ëª©ë¡ ì˜ì—­ -->
        <div class="modal-comment-area">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">ëŒ“ê¸€</h2>
          <div id="modalCommentList" class="comment-list space-y-3">
            <!-- ëŒ“ê¸€ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div class="flex mt-auto pt-4 border-t border-gray-200">
            <input
              type="text"
              id="modalCommentInput"
              placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..."
              class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <button
              id="modalCommentSubmitButton"
              class="ml-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200"
            >
              ë“±ë¡
            </button>
          </div>
        </div>

        <!-- ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ -->
        <button
          id="closeCommentModalButton"
          class="absolute top-4 right-4"
          aria-label="ëª¨ë‹¬ ë‹«ê¸°"
        >
          &times;
        </button>
      </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal" id="confirmationModal">
      <div class="modal-content">
        <h3 id="confirmationMessage" class="mb-4 text-lg"></h3>
        <button
          id="confirmYesBtn"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
        >
          ë„¤
        </button>
        <button
          id="confirmNoBtn"
          class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded ml-2"
        >
          ì•„ë‹ˆì˜¤
        </button>
      </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ì•Œë¦¼ ëª¨ë‹¬ -->
    <div class="modal" id="alertDialog">
      <div class="modal-content">
        <h3 id="alertMessage" class="mb-4 text-lg"></h3>
        <button
          id="closeAlertModal"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
        >
          í™•ì¸
        </button>
      </div>
    </div>

    <!-- ì „ì²´ ì‚­ì œ ë²„íŠ¼ (ë§ˆì´í˜ì´ì§€ìš©) -->
    <div style="text-align: center; margin: 30px">
      <button id="clearAllBtn">ğŸ—‘ ëª¨ë“  ê²Œì‹œê¸€/ëŒ“ê¸€ ì‚­ì œ</button>
    </div>

    <script>
      // í”„ë¡œí•„ í˜ì´ì§€ ê´€ë ¨ DOM ìš”ì†Œ
      const profileImage = document.getElementById("profileImage");
      const imageInput = document.getElementById("imageInput");
      const displayNameElement = document.getElementById("displayName");
      const bioElement = document.getElementById("bio");
      const phoneNumberElement = document.getElementById("phoneNumber");
      const editProfileBtn = document.getElementById("editProfileBtn");
      const userPostsGrid = document.getElementById("userPostsGrid");
      const clearAllBtn = document.getElementById("clearAllBtn");

      // í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ ê´€ë ¨ DOM ìš”ì†Œ
      const editModal = document.getElementById("editModal");
      const nameInput = document.getElementById("nameInput");
      const phoneInput = document.getElementById("phoneInput");
      const bioInput = document.getElementById("bioInput");
      const saveBtn = document.getElementById("saveBtn");
      const closeEditModal = document.getElementById("closeEditModal");

      // ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ ê´€ë ¨ DOM ìš”ì†Œ
      const imageModal = document.getElementById("imageModal");
      const modalImage = document.getElementById("modalImage");
      const closeImageModal = document.getElementById("closeImageModal");

      // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°(ëŒ“ê¸€) ëª¨ë‹¬ ê´€ë ¨ DOM ìš”ì†Œ
      const commentModal = document.getElementById("commentModal");
      const modalPostTitle = document.getElementById("modalPostTitle");
      const modalPostImage = document.getElementById("modalPostImage");
      const modalPostText = document.getElementById("modalPostText");
      const modalPostTags = document.getElementById("modalPostTags");
      const modalPostAuthor = document.getElementById("modalPostAuthor");
      const modalPostTime = document.getElementById("modalPostTime");
      const modalCommentList = document.getElementById("modalCommentList");
      const modalCommentInput = document.getElementById("modalCommentInput");
      const modalCommentSubmitButton = document.getElementById(
        "modalCommentSubmitButton"
      );
      const closeCommentModalButton = document.getElementById(
        "closeCommentModalButton"
      );

      // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (íˆ´ë°”)
      const profileLoginButton = document.getElementById("profileLoginButton");
      const profileSignupButton = document.getElementById(
        "profileSignupButton"
      );
      const profileLogoutButton = document.getElementById(
        "profileLogoutButton"
      );

      // ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜
      let currentUserProfile = {};
      let allPosts = [];
      let currentViewingPostCard = null; // í˜„ì¬ íŒì—…ìœ¼ë¡œ ë³´ê³  ìˆëŠ” ê²Œì‹œê¸€ ë°ì´í„°

      // =================================================================
      // ğŸŒ ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ (ë©”ì¸ í˜ì´ì§€ì™€ ê³µìœ ë˜ëŠ” í•µì‹¬ ë¡œì§)
      // =================================================================

      /**
       * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³ , ë°ì´í„° êµ¬ì¡°ë¥¼ ìµœì‹ ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.
       */
      function loadPosts() {
        const storedPosts = localStorage.getItem("snsPosts");
        if (storedPosts) {
          allPosts = JSON.parse(storedPosts);
          // ë°ì´í„° êµ¬ì¡° ë§ˆì´ê·¸ë ˆì´ì…˜ (í•˜ìœ„ í˜¸í™˜ì„± ë³´ì¥)
          allPosts.forEach((post) => {
            if (!post.likedBy) post.likedBy = []; // ê²Œì‹œê¸€ likedBy ì¶”ê°€
            if (!post.comments) post.comments = [];

            const migrateComments = (comments) => {
              comments.forEach((comment) => {
                // 'likers' ë˜ëŠ” 'likes' ì†ì„±ì´ ìˆë‹¤ë©´ 'likedBy'ë¡œ ë³€í™˜
                if (comment.likers && !comment.likedBy) {
                  comment.likedBy = [...comment.likers];
                  delete comment.likers;
                } else if (!comment.likedBy) {
                  comment.likedBy = [];
                }
                // ì˜ˆì „ ì†ì„± ì‚­ì œ
                delete comment.likes;
                delete comment.liked;

                if (!comment.replies) {
                  comment.replies = [];
                } else {
                  migrateComments(comment.replies); // ì¬ê·€ì ìœ¼ë¡œ ë‹µê¸€ë„ ë§ˆì´ê·¸ë ˆì´ì…˜
                }
              });
            };
            migrateComments(post.comments);
          });
        } else {
          allPosts = [];
        }
      }

      /**
       * í˜„ì¬ ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.
       */
      function savePosts() {
        localStorage.setItem("snsPosts", JSON.stringify(allPosts));
      }

      // =================================================================
      // ğŸ‘¤ í”„ë¡œí•„ ê´€ë¦¬ í•¨ìˆ˜ (í”„ë¡œí•„ í˜ì´ì§€ ê³ ìœ  ë¡œì§)
      // =================================================================

      /**
       * ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¡œë“œí•˜ê³  í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
       */
      function loadUserProfile() {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) {
          displayNameElement.textContent = "ë¡œê·¸ì¸ í•„ìš”";
          bioElement.textContent = "í”„ë¡œí•„ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”.";
          profileImage.src = getRandomProfileUrl();
          editProfileBtn.style.display = "none";
          profileLoginButton.style.display = "list-item";
          profileSignupButton.style.display = "list-item";
          profileLogoutButton.style.display = "none";
          userPostsGrid.innerHTML =
            '<p class="text-gray-500 text-center col-span-full">ê²Œì‹œê¸€ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>';
          return;
        }

        const users = JSON.parse(localStorage.getItem("users")) || [];
        const user = users.find((u) => u.username === loggedInUser);

        if (user) {
          currentUserProfile = {
            username: user.username,
            bio: user.bio || "ì¸ì‚¬ë§ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.",
            phoneNumber: user.phoneNumber || "ì „í™”ë²ˆí˜¸ ì—†ìŒ",
            profileImageBase64:
              user.profileImageBase64 || getRandomProfileUrl(),
          };
          displayNameElement.textContent = currentUserProfile.username;
          bioElement.textContent = currentUserProfile.bio;
          phoneNumberElement.textContent = currentUserProfile.phoneNumber;
          profileImage.src = currentUserProfile.profileImageBase64;
          editProfileBtn.style.display = "block";
          profileLoginButton.style.display = "none";
          profileSignupButton.style.display = "none";
          profileLogoutButton.style.display = "list-item";

          loadPosts(); // ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ
          renderUserPosts(); // ì‚¬ìš©ì ê²Œì‹œê¸€ ë Œë”ë§
        } else {
          localStorage.removeItem("loggedInUser");
          loadUserProfile(); // ì¬ê·€ í˜¸ì¶œë¡œ ë¡œê·¸ì¸ í™”ë©´ ìƒíƒœë¡œ ì „í™˜
        }
      }

      /**
       * ë³€ê²½ëœ í”„ë¡œí•„ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
       */
      function saveUserProfile() {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) return;

        let users = JSON.parse(localStorage.getItem("users")) || [];
        const userIndex = users.findIndex((u) => u.username === loggedInUser);

        if (userIndex !== -1) {
          users[userIndex] = { ...users[userIndex], ...currentUserProfile };
          localStorage.setItem("users", JSON.stringify(users));
        }
      }

      function getRandomProfileUrl() {
        const randomId = Math.floor(Math.random() * 70) + 1;
        return `https://marketplace.canva.com/EAGJIUknLqs/2/0/1600w/canva-%EB%82%A8%EC%83%89-%ED%96%89%EC%84%B1-%EC%9A%B0%EC%A3%BC%EB%B9%84%ED%96%89%EC%82%AC-%EC%9D%BC%EB%9F%AC%EC%8A%A4%ED%8A%B8-%EC%97%AC%ED%96%89-%ED%83%90%ED%97%98-%EC%BB%B4%ED%93%A8%ED%84%B0-%EB%B0%B0%EA%B2%BD%ED%99%94%EB%A9%B4-qOyFvDSniwE.jpg`;
      }

      /**
       * ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ê²Œì‹œê¸€ë§Œ í•„í„°ë§í•˜ì—¬ í™”ë©´ì— ë Œë”ë§í•©ë‹ˆë‹¤.
       */
      function renderUserPosts() {
        userPostsGrid.innerHTML = "";
        const loggedInUser = localStorage.getItem("loggedInUser");
        const userPosts = allPosts.filter(
          (post) => post.author === loggedInUser
        );

        if (userPosts.length === 0) {
          userPostsGrid.innerHTML =
            '<p class="text-gray-500 text-center col-span-full">ì•„ì§ ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        userPosts.forEach((post) => {
          const postCard = createPostCardElement(post); // ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ì¹´ë“œ ìƒì„± í•¨ìˆ˜ ì‚¬ìš©
          userPostsGrid.appendChild(postCard);
        });
      }

      /**
       * ê²Œì‹œê¸€ ë°ì´í„°ë¡œ DOM ìš”ì†Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ë©”ì¸ í˜ì´ì§€ì˜ ì¹´ë“œì™€ ë™ì¼í•œ ëª¨ì–‘)
       */

      function createPostCardElement(postData) {
        const postCard = document.createElement("div");
        postCard.classList.add("post-card");
        postCard.dataset.postId = postData.id;

        const truncatedContent =
          postData.text.length > 50
            ? postData.text.substring(0, 47) + "..."
            : postData.text;
        let imageHtml = postData.imageUrl
          ? `<img src="${postData.imageUrl}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" class="post-card-image">`
          : "";

        postCard.innerHTML = `
            ${imageHtml}
            <div class="post-card-content-wrapper">
                <h4 class="post-card-title">${
                  postData.text.split("\n")[0] || "ì œëª© ì—†ìŒ"
                }</h4>
                <p class="post-card-text">${truncatedContent}</p>
            </div>
            <button class="post-card-delete-btn">ì‚­ì œ</button>
        `;

        // ì¹´ë“œ ì „ì²´ í´ë¦­ ì‹œ ìƒì„¸ ë³´ê¸° íŒì—… ì—´ê¸°
        postCard.addEventListener("click", (event) => {
          // ì‚­ì œ ë²„íŠ¼ì´ ì•„ë‹Œ ì˜ì—­ì„ í´ë¦­í–ˆì„ ë•Œë§Œ íŒì—… ì—´ê¸°
          if (!event.target.classList.contains("post-card-delete-btn")) {
            openPostViewModal(postData.id);
          }
        });

        /**
         * íŠ¹ì • IDì˜ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
         * @param {string} postId ì‚­ì œí•  ê²Œì‹œê¸€ì˜ ID
         */
        function deletePost(postId) {
          // í•´ë‹¹ IDë¥¼ ê°€ì§„ ê²Œì‹œê¸€ì„ ì œì™¸í•˜ê³  ìƒˆë¡œìš´ ë°°ì—´ì„ ë§Œë“­ë‹ˆë‹¤.
          allPosts = allPosts.filter((post) => post.id !== postId);

          // ë³€ê²½ëœ ê²Œì‹œê¸€ ëª©ë¡ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.
          savePosts();

          // ê²Œì‹œê¸€ ëª©ë¡ì„ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ í™”ë©´ì—ì„œ ì‚­ì œëœ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
          renderUserPosts();

          alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        // ì‚­ì œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const deleteBtn = postCard.querySelector(".post-card-delete-btn");
        deleteBtn.addEventListener("click", (event) => {
          event.stopPropagation(); // ì¹´ë“œ ì „ì²´ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
          // ì‚¬ìš©ìì—ê²Œ ì‚­ì œ ì—¬ë¶€ í™•ì¸
          if (confirm("ì´ ê²Œì‹œê¸€ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            deletePost(postData.id);
          }
        });

        return postCard;
      }
      /**
       * ì‚¬ìš©ì ì´ë¦„ ë³€ê²½ ì‹œ ëª¨ë“  ê²Œì‹œë¬¼/ëŒ“ê¸€/ë‹µê¸€ì˜ ì‘ì„±ì ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
       * @param {string} oldUsername ì´ì „ ì‚¬ìš©ì ì´ë¦„
       * @param {string} newUsername ìƒˆë¡œìš´ ì‚¬ìš©ì ì´ë¦„
       */
      function updateDataOnUsernameChange(oldUsername, newUsername) {
        allPosts.forEach((post) => {
          // ê²Œì‹œê¸€ ì‘ì„±ì ì´ë¦„ ë³€ê²½
          if (post.author === oldUsername) {
            post.author = newUsername;
          }
          // ëŒ“ê¸€ê³¼ ë‹µê¸€ì˜ ì‘ì„±ì ì´ë¦„ ë³€ê²½ (ì¬ê·€ í•¨ìˆ˜ ì‚¬ìš©)
          const updateCommentUsername = (comments) => {
            if (!comments) return;
            comments.forEach((comment) => {
              if (comment.username === oldUsername) {
                comment.username = newUsername;
              }
              if (comment.replies) {
                updateCommentUsername(comment.replies); // ë‹µê¸€ë„ ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬
              }
            });
          };
          updateCommentUsername(post.comments);
        });
        // ë³€ê²½ëœ ì „ì²´ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
        savePosts();
      }
      /**
       * ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° íŒì—…(ëŒ“ê¸€ ëª¨ë‹¬)ì„ ì—½ë‹ˆë‹¤.
       */
      function openPostViewModal(postId) {
        const postData = allPosts.find((p) => p.id === postId);
        if (!postData) return;

        currentViewingPostCard = postData; // í˜„ì¬ ë³´ê³  ìˆëŠ” ê²Œì‹œê¸€ ë°ì´í„° ì„¤ì •

        // íŒì—…ì— ê²Œì‹œê¸€ ë‚´ìš© ì±„ìš°ê¸°
        modalPostTitle.textContent =
          postData.text.split("\n")[0] || "ì œëª© ì—†ìŒ";
        modalPostText.textContent = postData.text;
        modalPostAuthor.textContent = `ì‘ì„±ì: ${postData.author}`;
        modalPostTime.textContent = postData.time;

        if (postData.imageUrl) {
          modalPostImage.src = postData.imageUrl;
          modalPostImage.classList.remove("hidden");
        } else {
          modalPostImage.classList.add("hidden");
          modalPostImage.src = "";
        }

        modalPostTags.innerHTML = (postData.tags || [])
          .map(
            (tag) =>
              `<span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-full">#${tag}</span>`
          )
          .join("");

        // ëŒ“ê¸€ ëª©ë¡ ë Œë”ë§ (ë©”ì¸ í˜ì´ì§€ì™€ ê³µìœ ë˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ)
        window.renderComments(postData.comments || [], modalCommentList);
        commentModal.style.display = "flex";
      }

      window.renderComments = function (comments, container, isReply = false) {
        container.innerHTML = "";
        const loggedInUser = localStorage.getItem("loggedInUser");

        if (!comments || comments.length === 0) {
          const noCommentMessage = document.createElement("p");
          noCommentMessage.classList.add(
            "text-gray-500",
            "text-center",
            "py-4"
          );
          noCommentMessage.textContent = isReply
            ? "ì•„ì§ ë‹µê¸€ì´ ì—†ìŠµë‹ˆë‹¤."
            : "ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!";
          container.appendChild(noCommentMessage);
          return;
        }

        comments.forEach((comment) => {
          const hasUserLikedComment =
            loggedInUser && (comment.likedBy || []).includes(loggedInUser);
          const commentItem = document.createElement("div");
          commentItem.dataset.id = comment.id;
          commentItem.classList.add(isReply ? "reply-item" : "comment-item");

          commentItem.innerHTML = `
                <div class="comment-content-wrapper">
                    <div class="comment-text-line">
                        <span class="comment-username">${
                          comment.username
                        }</span>
                        <span class="comment-body">${comment.text}</span>
                    </div>
                    <div class="comment-time">${comment.time}</div>
                </div>
                <div class="comment-actions">
                    <button class="like-button ${
                      hasUserLikedComment ? "text-red-500" : "text-gray-500"
                    }" onclick="window.toggleCommentLike(this)">
                        <span class="comment-like-count">${
                          (comment.likedBy || []).length
                        }ê°œ</span> ì¢‹ì•„ìš”
                    </button>
                    ${
                      !isReply
                        ? `<button onclick="window.toggleReplyInput(this)">ë‹µê¸€ ë‹¬ê¸°</button>`
                        : ""
                    }
                </div>
                <div class="reply-input-area hidden mt-3">
                    <input type="text" placeholder="ë‹µê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..." class="w-full px-3 py-2 text-sm border rounded-lg">
                    <button onclick="window.submitReply(this)">ë“±ë¡</button>
                </div>
                ${
                  !isReply && comment.replies && comment.replies.length > 0
                    ? `<button class="view-replies-toggle" onclick="window.toggleViewReplies(this)">â€” ë‹µê¸€ ë³´ê¸° (${comment.replies.length}ê°œ)</button>`
                    : ""
                }
                <div class="replies-list mt-3 space-y-2 hidden"></div>
            `;
          container.appendChild(commentItem);

          if (comment.replies && comment.replies.length > 0) {
            const repliesListContainer =
              commentItem.querySelector(".replies-list");
            window.renderComments(comment.replies, repliesListContainer, true);
          }
        });
      };

      window.toggleCommentLike = function (button) {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) {
          alert("ë¡œê·¸ì¸í•´ì•¼ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }

        const commentItem = button.closest(".comment-item, .reply-item");
        const commentId = commentItem.dataset.id;

        const findCommentOrReply = (commentsArray, id) => {
          for (const item of commentsArray) {
            if (item.id === id) return item;
            if (item.replies) {
              const foundInReplies = findCommentOrReply(item.replies, id);
              if (foundInReplies) return foundInReplies;
            }
          }
          return null;
        };

        const commentObj = findCommentOrReply(
          currentViewingPostCard.comments,
          commentId
        );

        if (commentObj) {
          if (!commentObj.likedBy) commentObj.likedBy = [];
          const likeIndex = commentObj.likedBy.indexOf(loggedInUser);

          if (likeIndex > -1) {
            commentObj.likedBy.splice(likeIndex, 1);
          } else {
            commentObj.likedBy.push(loggedInUser);
          }

          savePosts();
          // UI ì§ì ‘ ì—…ë°ì´íŠ¸
          const hasUserLiked = commentObj.likedBy.includes(loggedInUser);
          button.classList.toggle("text-red-500", hasUserLiked);
          button.classList.toggle("text-gray-500", !hasUserLiked);
          button.querySelector(
            ".comment-like-count"
          ).textContent = `${commentObj.likedBy.length}ê°œ`;
        }
      };

      window.toggleReplyInput = function (button) {
        const commentItem = button.closest(".comment-item");
        const replyInputArea = commentItem.querySelector(".reply-input-area");
        replyInputArea.classList.toggle("hidden");
        if (!replyInputArea.classList.contains("hidden")) {
          replyInputArea.querySelector("input").focus();
        }
      };

      window.submitReply = function (button) {
        const loggedInUser = localStorage.getItem("loggedInUser");
        if (!loggedInUser) {
          alert("ë¡œê·¸ì¸í•´ì•¼ ë‹µê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          return;
        }

        const replyInputArea = button.closest(".reply-input-area");
        const replyInput = replyInputArea.querySelector("input");
        const replyText = replyInput.value.trim();
        if (!replyText) {
          alert("ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const parentCommentItem = replyInputArea.closest(".comment-item");
        const parentCommentId = parentCommentItem.dataset.id;

        const findComment = (commentsArray, id) => {
          for (const item of commentsArray) {
            if (item.id === id) return item;
            if (item.replies) {
              const found = findComment(item.replies, id);
              if (found) return found;
            }
          }
          return null;
        };

        const parentCommentObj = findComment(
          currentViewingPostCard.comments,
          parentCommentId
        );

        if (parentCommentObj) {
          const now = new Date();
          const options = {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "numeric",
            minute: "numeric",
            hour12: true,
          };
          const currentTimeFormatted = now.toLocaleString("ko-KR", options);

          const newReply = {
            id: "reply-" + Date.now(),
            username: loggedInUser,
            text: replyText,
            time: currentTimeFormatted,
            likedBy: [],
            replies: [], // ë‹µê¸€ì˜ ë‹µê¸€ë„ ê°€ëŠ¥í•˜ë„ë¡ replies ë°°ì—´ ì¶”ê°€
          };

          if (!parentCommentObj.replies) parentCommentObj.replies = [];
          parentCommentObj.replies.push(newReply);

          savePosts();
          // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
          window.renderComments(
            currentViewingPostCard.comments,
            modalCommentList
          );
        }
      };

      window.toggleViewReplies = function (button) {
        const commentItem = button.closest(".comment-item");
        const repliesList = commentItem.querySelector(".replies-list");
        const isHidden = repliesList.classList.contains("hidden");

        repliesList.classList.toggle("hidden");
        button.textContent = isHidden
          ? `â€” ë‹µê¸€ ìˆ¨ê¸°ê¸° (${repliesList.children.length}ê°œ)`
          : `â€” ë‹µê¸€ ë³´ê¸° (${repliesList.children.length}ê°œ)`;
      };

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœì´ˆ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", () => {
        loadUserProfile();

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½
        imageInput.addEventListener("change", function () {
          const file = this.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              profileImage.src = e.target.result;
              currentUserProfile.profileImageBase64 = e.target.result;
              saveUserProfile();
            };
            reader.readAsDataURL(file);
          }
        });

        // í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
        editProfileBtn.addEventListener("click", () => {
          nameInput.value = currentUserProfile.username;
          phoneInput.value = currentUserProfile.phoneNumber;
          bioInput.value = currentUserProfile.bio;
          editModal.style.display = "flex";
        });

        // í”„ë¡œí•„ ì €ì¥
        saveBtn.addEventListener("click", () => {
          const oldUsername = currentUserProfile.username; // ë³€ê²½ ì „ ì´ë¦„ ì €ì¥
          const newUsername = nameInput.value.trim(); // ë³€ê²½ í›„ ì´ë¦„

          // í”„ë¡œí•„ ì •ë³´ ê°ì²´ ì—…ë°ì´íŠ¸
          currentUserProfile.username = newUsername;
          currentUserProfile.phoneNumber = phoneInput.value.trim();
          currentUserProfile.bio = bioInput.value.trim();

          // users ë°°ì—´ì— í”„ë¡œí•„ ì •ë³´ ì €ì¥
          saveUserProfile();

          // ì´ë¦„ì´ ì‹¤ì œë¡œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if (oldUsername !== newUsername) {
            // 1. í˜„ì¬ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ìƒˆ ì´ë¦„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            localStorage.setItem("loggedInUser", newUsername);
            // 2. ëª¨ë“  ê²Œì‹œë¬¼/ëŒ“ê¸€ì˜ ì‘ì„±ì ì •ë³´ë¥¼ ìƒˆ ì´ë¦„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            updateDataOnUsernameChange(oldUsername, newUsername);
          }

          // ë³€ê²½ëœ ì •ë³´ë¡œ í”„ë¡œí•„ í™”ë©´ ë‹¤ì‹œ ë¡œë“œ
          loadUserProfile();
          editModal.style.display = "none";
          alert("í”„ë¡œí•„ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        });

        // í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
        closeEditModal.addEventListener(
          "click",
          () => (editModal.style.display = "none")
        );

        // ê²Œì‹œê¸€ ìƒì„¸ íŒì—… ë‹«ê¸°
        closeCommentModalButton.addEventListener(
          "click",
          () => (commentModal.style.display = "none")
        );

        // ëŒ“ê¸€ ë“±ë¡ ë²„íŠ¼
        modalCommentSubmitButton.addEventListener("click", () => {
          const loggedInUser = localStorage.getItem("loggedInUser");
          if (!loggedInUser) {
            alert("ë¡œê·¸ì¸í•´ì•¼ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return;
          }

          const commentText = modalCommentInput.value.trim();
          if (commentText && currentViewingPostCard) {
            const now = new Date();
            const options = {
              year: "numeric",
              month: "long",
              day: "numeric",
              hour: "numeric",
              minute: "numeric",
              hour12: true,
            };
            const currentTimeFormatted = now.toLocaleString("ko-KR", options);

            const newComment = {
              id: "comment-" + Date.now(),
              username: loggedInUser,
              text: commentText,
              time: currentTimeFormatted,
              likedBy: [],
              replies: [],
            };

            if (!currentViewingPostCard.comments)
              currentViewingPostCard.comments = [];
            currentViewingPostCard.comments.push(newComment);
            savePosts();

            window.renderComments(
              currentViewingPostCard.comments,
              modalCommentList
            );
            modalCommentInput.value = "";
            modalCommentList.scrollTop = modalCommentList.scrollHeight;
          }
        });

        // ë¡œê·¸ì•„ì›ƒ
        profileLogoutButton.addEventListener("click", () => {
          localStorage.removeItem("loggedInUser");
          window.location.reload();
        });
      });
    </script>
  </body>
</html>
